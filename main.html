<!DOCTYPE html>
<html>
<head>
    <title>Interior Editor</title>
    <script src="https://preview.babylonjs.com/babylon.js"></script> <!-- import babylonjs -->
    <script src="https://preview.babylonjs.com/gui/babylon.gui.js"></script> <!-- GUI for babylonjs -->
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script> <!-- scene loaders -->
    <script src="https://code.jquery.com/pep/0.4.3/pep.js"></script> <!-- scene interactions -->
    
    <style>
        html, body
        {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #render
        {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>

<body>
    <canvas id="render" touch-action="none"> <!-- canvas creation -->
    <script>
        var canvas = document.getElementById("render"); // initialise the canvas
        var engine = new BABYLON.Engine(canvas, true); // initialise the engine
        var createScene = function(){
            var scene = new BABYLON.Scene(engine); // the scene
            scene.gravity = new BABYLON.Vector3(0, -0.9, 0); // adds gravity
            scene.collisionsEnabled = true; // allows collisions to be added

            var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene); // the light of the scene

            var camera1 = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 4, 25, new BABYLON.Vector3(0, 0, 0), scene); // viewing camera
            var camera2 = new BABYLON.UniversalCamera("camera_1person", new BABYLON.Vector3(0, 2, -4), scene); // first person camera
            camera1.attachControl(canvas, true); // attach camera to canvas
            camera2.checkCollisions = true;
            camera2.applyGravity = true;

            // custom camera movement input
            camera2.keysUp.push(87);    //W
            camera2.keysLeft.push(65);  //A
            camera2.keysRight.push(68); //S
            camera2.keysDown.push(83);   //D

            // functions to set the camera mode
            var setArcCam = function(){
                scene.activeCamera = camera1;
                camera1.attachControl(canvas, true);
                camera1.radius = 25;
            };

            var setUniCam = function(){
                scene.activeCamera = camera2;
                camera2.attachControl(canvas, true);
                camera2.position = new BABYLON.Vector3(0, 2, -4);
            };

            camera2.ellipsoid = new BABYLON.Vector3(1, 1, 1);

            // so that objects can be controlled in gizmo
            var gizmoManager = new BABYLON.GizmoManager(scene);
            gizmoManager.attachableMeshes = [];

            // create unpickable objects for walls and floors
            var unpickable_meshes = [];

            var map = {}; //object for multiple key presses
            scene.actionManager = new BABYLON.ActionManager(scene);

            // registering action of key presses
            scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger, function (evt) {
                map[evt.sourceEvent.key] = evt.sourceEvent.type == "keydown";
            }));
            
            scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger, function (evt) {
                map[evt.sourceEvent.key] = evt.sourceEvent.type == "keydown";
            }));

            // boolean for setting the status mode of scene
            var delete_item = false;
            var clone_item = false;

            // gizmo controls
            scene.registerBeforeRender(function () {
                if (map["z"]) {               // position gizmo 
                    gizmoManager.positionGizmoEnabled = true;
                    gizmoManager.rotationGizmoEnabled = false;
                    gizmoManager.scaleGizmoEnabled = false;
                    gizmoManager.boundingBoxGizmoEnabled = false;
                    delete_item = false;
                    clone_item = false;
                };
                if (map["x"]) {               // rotation gizmo
                    gizmoManager.positionGizmoEnabled = false;
                    gizmoManager.rotationGizmoEnabled = true;
                    gizmoManager.scaleGizmoEnabled = false;
                    gizmoManager.boundingBoxGizmoEnabled = false;
                    delete_item = false;
                    clone_item = false;
                };
                if (map["c"]) {               // scaling and box gizmo
                    gizmoManager.positionGizmoEnabled = false;
                    gizmoManager.rotationGizmoEnabled = false;
                    gizmoManager.scaleGizmoEnabled = true;
                    gizmoManager.boundingBoxGizmoEnabled = true;
                    delete_item = false;
                    clone_item = false;
                };
                if (map["v"]) {                 // cloning mode
                    gizmoManager.positionGizmoEnabled = false;
                    gizmoManager.rotationGizmoEnabled = false;
                    gizmoManager.scaleGizmoEnabled = false;
                    gizmoManager.boundingBoxGizmoEnabled = false;
                    delete_item = false;
                    clone_item = true;
                    text1.text = "Current Status: Clone";
                }
                if (map["b"]){                  // neutral mode
                    gizmoManager.attachToMesh(null);
                    gizmoManager.positionGizmoEnabled = false;
                    gizmoManager.rotationGizmoEnabled = false;
                    gizmoManager.scaleGizmoEnabled = false;
                    gizmoManager.boundingBoxGizmoEnabled = false;
                    delete_item = false;
                    clone_item = false;
                    text1.text = "Current Status: Neutral";
                };

                if (map["n"]) {                 // delete mode
                    gizmoManager.attachToMesh(null);
                    gizmoManager.positionGizmoEnabled = false;
                    gizmoManager.rotationGizmoEnabled = false;
                    gizmoManager.scaleGizmoEnabled = false;
                    gizmoManager.boundingBoxGizmoEnabled = false;
                    delete_item = true;
                    clone_item = false;
                    text1.text = "Current Status: Delete";
                };
            });

            // dipsose or clone mesh if criteria matches
            scene.onPointerDown = function(evt, pickResult) {
                if (pickResult.pickedMesh) {
                    if(!unpickable_meshes.includes(pickResult.pickedMesh) && delete_item == true){
                        pickResult.pickedMesh.dispose();
                    }
                    else if(!unpickable_meshes.includes(pickResult.pickedMesh)&& clone_item == true){
                        newclone = pickResult.pickedMesh.clone();
                        newclone.makeGeometryUnique();
                        newclone.position = new BABYLON.Vector3(0,6,0);
                        gizmoManager.attachableMeshes.push(newclone);
                    }
                };
            };
		

            // materials for the mesh

            var wallmat1 = new BABYLON.StandardMaterial("wallmat1", scene); // wall material
	        wallmat1.diffuseTexture = new BABYLON.Texture("./materials/wallmat1.jpg", scene); // importing image for material

            var wallmat2 = new BABYLON.StandardMaterial("wallmat2", scene);
            wallmat2.diffuseTexture = new BABYLON.Texture("./materials/wallmat2.jpg", scene);

            var wallmat3 = new BABYLON.StandardMaterial("wallmat3", scene);
            wallmat3.diffuseTexture = new BABYLON.Texture("./materials/wallmat3.png", scene);

            var wallmat4 = new BABYLON.StandardMaterial("wallmat4", scene);
            wallmat4.diffuseTexture = new BABYLON.Texture("./materials/wallmat4.png", scene);

            var floormat1 = new BABYLON.StandardMaterial("floormat1", scene); // floor material
            floormat1.diffuseTexture = new BABYLON.Texture("./materials/floormat1.jpg", scene);

            var floormat2 = new BABYLON.StandardMaterial("floormat2", scene);
            floormat2.diffuseTexture = new BABYLON.Texture("./materials/floormat2.jpg", scene);

            var floormat3 = new BABYLON.StandardMaterial("floormat3", scene);
            floormat3.diffuseTexture = new BABYLON.Texture("./materials/floormat3.jpg", scene);

            var floormat4 = new BABYLON.StandardMaterial("floormat4", scene);
            floormat4.diffuseTexture = new BABYLON.Texture("./materials/floormat4.jpg", scene);

            // options for the mesh builder
            var optground_a = {
                xmin: -10,
                zmin: -5,
                xmax: 10,
                zmax: 5,
                subdivisions: {h: 5, w: 10},
                precision: {h: 2, w: 2}
            }

            var optground_b = {
                xmin: -12,
                zmin: -12,
                xmax: 12,
                zmax: 12,
                subdivisions: {h: 12, w: 12},
                precision: {h: 2, w: 2}
            }

            var optwall_a1 = {
                sideOrientation: BABYLON.Mesh.DOUBLESIDE,
                pattern: BABYLON.Mesh.NO_FLIP,
                height: 4,
                width: 21,
                depth: 0.5,
                tileSize: 2
            }

            var optwall_a2 = {
                sideOrientation: BABYLON.Mesh.DOUBLESIDE,
                pattern: BABYLON.Mesh.NO_FLIP,
                height: 4,
                width: 10,
                depth: 0.5,
                tileSize: 2
            }

            var optwall_b1 = {
                sideOrientation: BABYLON.Mesh.DOUBLESIDE,
                pattern: BABYLON.Mesh.NO_FLIP,
                height: 4,
                width: 24,
                depth: 0.5,
                tileSize: 2
            }

            var optwall_b2 = {
                sideOrientation: BABYLON.Mesh.DOUBLESIDE,
                pattern: BABYLON.Mesh.NO_FLIP,
                height: 4,
                width: 25,
                depth: 0.5,
                tileSize: 2
            }

            var optwall_b3 = {
                sideOrientation: BABYLON.Mesh.DOUBLESIDE,
                pattern: BABYLON.Mesh.NO_FLIP,
                height: 4,
                width: 11.75,
                depth: 0.5,
                tileSize: 2
            }


            // scene A ground
            var ground_a = new BABYLON.MeshBuilder.CreateTiledGround("ground_a", optground_a, scene); // create the ground
            ground_a.material = floormat1;

            // scene B ground
            var ground_b = new BABYLON.MeshBuilder.CreateTiledGround("ground_b", optground_b, scene);
            ground_b.material = floormat1;
            
            // scene A walls
            var wall_a1 = new BABYLON.MeshBuilder.CreateTiledBox("wall_a1", optwall_a1, scene); // create the wall for the ground to make room
            wall_a1.position = new BABYLON.Vector3(0, 2, 5.25);
            wall_a1.material = wallmat1;
            
            var wall_a2 = new BABYLON.MeshBuilder.CreateTiledBox("wall_a2", optwall_a2, scene); // wall for room
            wall_a2.position = new BABYLON.Vector3(10.25, 2, 0);
            wall_a2.rotation.y = Math.PI / 2;
            wall_a2.material = wallmat1;
            
            var wall_a3 = new BABYLON.MeshBuilder.CreateTiledBox("wall_a3", optwall_a1, scene); // wall for room
            wall_a3.position = new BABYLON.Vector3(0, 2, -5.25);
            wall_a3.material = wallmat1;

            var wall_a4 = new BABYLON.MeshBuilder.CreateTiledBox("wall_a4", optwall_a2, scene) // wall for room
            wall_a4.position = new BABYLON.Vector3(-10.25, 2, 0);
            wall_a4.rotation.y -= Math.PI / 2;
            wall_a4.material = wallmat1;

            // scene B walls
            var wall_b1 = new BABYLON.MeshBuilder.CreateTiledBox("wall_b1", optwall_b1, scene);
            wall_b1.position = new BABYLON.Vector3(0, 2, 12.25);
            wall_b1.material = wallmat1;

            var wall_b2 = new BABYLON.MeshBuilder.CreateTiledBox("wall_b2", optwall_b2, scene);
            wall_b2.position = new BABYLON.Vector3(12.25, 2, 0);
            wall_b2.rotation.y = Math.PI / 2;
            wall_b2.material = wallmat1;

            var wall_b3 = new BABYLON.MeshBuilder.CreateTiledBox("wall_b3", optwall_b1, scene);
            wall_b3.position = new BABYLON.Vector3(0, 2, -12.25);
            wall_b3.material = wallmat1;

            var wall_b4 = new BABYLON.MeshBuilder.CreateTiledBox("wall_b4", optwall_b2, scene);
            wall_b4.position = new BABYLON.Vector3(-12.25, 2, 0);
            wall_b4.rotation.y -= Math.PI / 2;
            wall_b4.material = wallmat1;

            var wall_rawb5 = new BABYLON.MeshBuilder.CreateTiledBox("wall_b5", optwall_b1, scene);
            wall_rawb5.material = wallmat1;
            wall_rawb5.position = new BABYLON.Vector3(0, 2, 0);
            var door_hole = new BABYLON.MeshBuilder.CreateTiledBox("door_hole", {width:2.5, height:3.5, depth:0.75}, scene);
            door_hole.position = new BABYLON.Vector3(-6, 1.5, 0);
            var door_hole2 = new BABYLON.MeshBuilder.CreateTiledBox("door_hole2", {width:2.5, height:3.5, depth:0.75}, scene);
            door_hole2.position = new BABYLON.Vector3(6, 1.5, 0);

            // to make holes on walls for doors
            var wallb5CSG = BABYLON.CSG.FromMesh(wall_rawb5);
            wallb5CSG.subtractInPlace(BABYLON.CSG.FromMesh(door_hole));
            wallb5CSG.subtractInPlace(BABYLON.CSG.FromMesh(door_hole2));

            var wall_b5 = wallb5CSG.toMesh("wall_b5", wallmat1, scene);
            wall_b5.position = new BABYLON.Vector3(0, 2, 0);

            var wall_b6 = new BABYLON.MeshBuilder.CreateTiledBox("wall_b6", optwall_b3, scene);
            wall_b6.position = new BABYLON.Vector3(0, 2, 6.125);
            wall_b6.rotation.y -= Math.PI / 2;
            wall_b6.material = wallmat1;

            // set initial check collisions, unpickable objects and visiblity
            ground_a.checkCollisions = true;
            wall_a1.checkCollisions = true;
            wall_a2.checkCollisions = true;
            wall_a3.checkCollisions = true;
            wall_a4.checkCollisions = true;
            unpickable_meshes.push(ground_a);
            unpickable_meshes.push(wall_a1);
            unpickable_meshes.push(wall_a2);
            unpickable_meshes.push(wall_a3);
            unpickable_meshes.push(wall_a4);

            ground_b.isVisible = false;
            wall_b1.isVisible = false;
            wall_b2.isVisible = false;
            wall_b3.isVisible = false;
            wall_b4.isVisible = false;
            wall_b5.isVisible = false;
            wall_b6.isVisible = false;
            unpickable_meshes.push(ground_b);
            unpickable_meshes.push(wall_b1);
            unpickable_meshes.push(wall_b2);
            unpickable_meshes.push(wall_b3);
            unpickable_meshes.push(wall_b4);
            unpickable_meshes.push(wall_b5);
            unpickable_meshes.push(wall_b6);

            wall_rawb5.isVisible = false;
            door_hole.isVisible = false;
            door_hole2.isVisible = false;

            // GUI
             
            var ui = new BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI", true, scene); // create the base ui
            var text_ui = new BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("textUI", true, scene);

            // button to change material of wall and floor
            var wall_but1 = new BABYLON.GUI.Button.CreateImageOnlyButton("wall_button", "./materials/wallmat1.jpg"); // create button
            wall_but1.width = "70px";
            wall_but1.height = "70px";
            wall_but1.color = "#000000";
            wall_but1.background = "#ffffff";
            wall_but1.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            wall_but1.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            wall_but1.left = "10px";
            wall_but1.top = "-120px";
            wall_but1.onPointerUpObservable.add(function(){
                wall_a1.material = wallmat1;
                wall_a2.material = wallmat1;
                wall_a3.material = wallmat1;
                wall_a4.material = wallmat1;
                
                wall_b1.material = wallmat1;
                wall_b2.material = wallmat1;
                wall_b3.material = wallmat1;
                wall_b4.material = wallmat1;
                wall_b5.material = wallmat1;
                wall_b6.material = wallmat1;
            });

            var wall_but2 = new BABYLON.GUI.Button.CreateImageOnlyButton("wall_button2", "./materials/wallmat2.jpg");
            wall_but2.width = "70px";
            wall_but2.height = "70px";
            wall_but2.color = "#000000";
            wall_but2.background = "#ffffff";
            wall_but2.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            wall_but2.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            wall_but2.left = "90px";
            wall_but2.top = "-120px";
            wall_but2.onPointerUpObservable.add(function(){
                wall_a1.material = wallmat2;
                wall_a2.material = wallmat2;
                wall_a3.material = wallmat2;
                wall_a4.material = wallmat2;

                wall_b1.material = wallmat2;
                wall_b2.material = wallmat2;
                wall_b3.material = wallmat2;
                wall_b4.material = wallmat2;
                wall_b5.material = wallmat2;
                wall_b6.material = wallmat2;
            });

            var wall_but3 = new BABYLON.GUI.Button.CreateImageOnlyButton("wall_button3", "./materials/wallmat3.png");
            wall_but3.width = "70px";
            wall_but3.height = "70px";
            wall_but3.color = "#000000";
            wall_but3.background = "#ffffff";
            wall_but3.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            wall_but3.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            wall_but3.left = "170px";
            wall_but3.top = "-120px";
            wall_but3.onPointerUpObservable.add(function(){
                wall_a1.material = wallmat3;
                wall_a2.material = wallmat3;
                wall_a3.material = wallmat3;
                wall_a4.material = wallmat3;

                wall_b1.material = wallmat3;
                wall_b2.material = wallmat3;
                wall_b3.material = wallmat3;
                wall_b4.material = wallmat3;
                wall_b5.material = wallmat3;
                wall_b6.material = wallmat3;
            });

            var wall_but4 = new BABYLON.GUI.Button.CreateImageOnlyButton("wall_button4", "./materials/wallmat4.png");
            wall_but4.width = "70px";
            wall_but4.height = "70px";
            wall_but4.color = "#000000";
            wall_but4.background = "#ffffff";
            wall_but4.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            wall_but4.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            wall_but4.left = "250px";
            wall_but4.top = "-120px";
            wall_but4.onPointerUpObservable.add(function(){
                wall_a1.material = wallmat4;
                wall_a2.material = wallmat4;
                wall_a3.material = wallmat4;
                wall_a4.material = wallmat4;

                wall_b1.material = wallmat4;
                wall_b2.material = wallmat4;
                wall_b3.material = wallmat4;
                wall_b4.material = wallmat4;
                wall_b5.material = wallmat4;
                wall_b6.material = wallmat4;
            });

            var floor_but1 = new BABYLON.GUI.Button.CreateImageOnlyButton("floor_button", "./materials/floormat1.jpg");
            floor_but1.width = "70px";
            floor_but1.height = "70px";
            floor_but1.color = "#000000";
            floor_but1.background = "#ffffff";
            floor_but1.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            floor_but1.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            floor_but1.left = "10px";
            floor_but1.top = "-20px";
            floor_but1.onPointerUpObservable.add(function(){ 
                ground_a.material = floormat1;
                ground_b.material = floormat1;
            });

            var floor_but2 = new BABYLON.GUI.Button.CreateImageOnlyButton("floor_button2", "./materials/floormat2.jpg");
            floor_but2.width = "70px";
            floor_but2.height = "70px";
            floor_but2.color = "#000000";
            floor_but2.background = "#ffffff";
            floor_but2.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            floor_but2.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            floor_but2.left = "90px";
            floor_but2.top = "-20px";
            floor_but2.onPointerUpObservable.add(function(){ 
                ground_a.material = floormat2;
                ground_b.material = floormat2;
            });

            var floor_but3 = new BABYLON.GUI.Button.CreateImageOnlyButton("floor_button3", "./materials/floormat3.jpg");
            floor_but3.width = "70px";
            floor_but3.height = "70px";
            floor_but3.color = "#000000";
            floor_but3.background = "#ffffff";
            floor_but3.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            floor_but3.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            floor_but3.left = "170px";
            floor_but3.top = "-20px";
            floor_but3.onPointerUpObservable.add(function(){ 
                ground_a.material = floormat3;
                ground_b.material = floormat3;
            });

            var floor_but4 = new BABYLON.GUI.Button.CreateImageOnlyButton("floor_button3", "./materials/floormat4.jpg");
            floor_but4.width = "70px";
            floor_but4.height = "70px";
            floor_but4.color = "#000000";
            floor_but4.background = "#ffffff";
            floor_but4.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            floor_but4.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            floor_but4.left = "250px";
            floor_but4.top = "-20px";
            floor_but4.onPointerUpObservable.add(function(){ 
                ground_a.material = floormat4;
                ground_b.material = floormat4;
            });

            // object loader, custom and inside the file
            var sofa_add = new BABYLON.GUI.Button.CreateSimpleButton("sofa_add", "Sofa");
            sofa_add.width = "70px";
            sofa_add.height = "70px";
            sofa_add.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            sofa_add.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            sofa_add.left = "-10px";
            sofa_add.top = "-10px";
            sofa_add.background = "#87cefa";
            sofa_add.onPointerUpObservable.add(function(){
                BABYLON.SceneLoader.ImportMesh(null, "./furnitures/livingroom/sofa/", "sofa.obj", scene, function(meshes) {
                    var sofa = meshes[0];
                    sofa = BABYLON.Mesh.MergeMeshes(meshes, true, true, undefined, false, true);
                    sofa.checkCollisions = true;
                    sofa.scaling = new BABYLON.Vector3(0.01, 0.01, 0.01);
                    sofa.position = new BABYLON.Vector3(0,6,0);
                    gizmoManager.attachableMeshes.push(sofa);
                });
            });

            var table_add = new BABYLON.GUI.Button.CreateSimpleButton("table_add", "Table");
            table_add.width = "70px";
            table_add.height = "70px";
            table_add.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            table_add.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            table_add.left = "-100px";
            table_add.top = "-10px";
            table_add.background = "#87cefa";
            table_add.onPointerUpObservable.add(function(){
                BABYLON.SceneLoader.ImportMesh(null, "./furnitures/livingroom/table/", "table.obj", scene, function(meshes) {
                    var table = meshes[0];
                    table = BABYLON.Mesh.MergeMeshes(meshes, true, true, undefined, false, true);
                    table.scaling = new BABYLON.Vector3(0.01, 0.01, 0.01);
                    table.position = new BABYLON.Vector3(0,6,0);                    
                    table.checkCollisions = true;
                    table.isPickable = true;
                    gizmoManager.attachableMeshes.push(table);
                });
            });

            var chair_add = new BABYLON.GUI.Button.CreateSimpleButton("chair_add", "Chair");
            chair_add.width = "70px";
            chair_add.height = "70px";
            chair_add.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            chair_add.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            chair_add.left = "-10px";
            chair_add.top = "-120px";
            chair_add.background = "#7cfc00";
            chair_add.onPointerUpObservable.add(function(){
                BABYLON.SceneLoader.ImportMesh(null, "./furnitures/bedroom/chair/", "chair.obj", scene, function(meshes) {
                    var chair = meshes[0];
                    chair = BABYLON.Mesh.MergeMeshes(meshes, true, true, undefined, false, true);
                    chair.position = new BABYLON.Vector3(0,6,0);                    
                    chair.checkCollisions = true;
                    chair.isPickable = true;
                    gizmoManager.attachableMeshes.push(chair);
                });
            });

            var bed_add = new BABYLON.GUI.Button.CreateSimpleButton("bed_add", "Bed");
            bed_add.width = "70px";
            bed_add.height = "70px";
            bed_add.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            bed_add.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            bed_add.left = "-100px";
            bed_add.top = "-120px";
            bed_add.background = "#7cfc00";
            bed_add.onPointerUpObservable.add(function(){
                BABYLON.SceneLoader.ImportMesh(null, "./furnitures/bedroom/bed/", "fixed-opem-sim-bead-model.obj", scene, function(meshes) {
                    var bed = meshes[0];
                    bed = BABYLON.Mesh.MergeMeshes(meshes, true, true, undefined, false, true);
                    bed.position = new BABYLON.Vector3(0,6,0);                    
                    bed.checkCollisions = true;
                    bed.isPickable = true;
                    gizmoManager.attachableMeshes.push(bed);
                });
            });

            var toilet_add = new BABYLON.GUI.Button.CreateSimpleButton("toilet_add", "Toilet");
            toilet_add.width = "70px";
            toilet_add.height = "70px";
            toilet_add.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            toilet_add.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            toilet_add.left = "-10px";
            toilet_add.top = "-230px";
            toilet_add.background = "#eee8aa";
            toilet_add.onPointerUpObservable.add(function(){
                BABYLON.SceneLoader.ImportMesh(null, "./furnitures/bathroom/toilet/", "toilet-water-closet.obj", scene, function(meshes) {
                    var toilet = meshes[0];
                    toilet = BABYLON.Mesh.MergeMeshes(meshes, true, true, undefined, false, true);
                    toilet.scaling = new BABYLON.Vector3(0.05, 0.05, 0.05);
                    toilet.position = new BABYLON.Vector3(0,6,0);                    
                    toilet.checkCollisions = true;
                    toilet.isPickable = true;
                    gizmoManager.attachableMeshes.push(toilet);
                });
            });

            var flower_add = new BABYLON.GUI.Button.CreateSimpleButton("flower_add", "Flower");
            flower_add.width = "70px";
            flower_add.height = "70px";
            flower_add.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            flower_add.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            flower_add.left = "-100px";
            flower_add.top = "-230px";
            flower_add.background = "#eee8aa";
            flower_add.onPointerUpObservable.add(function(){
                BABYLON.SceneLoader.ImportMesh(null, "./furnitures/bathroom/flower/", "flower.obj", scene, function(meshes) {
                    var flower = meshes[0];
                    flower = BABYLON.Mesh.MergeMeshes(meshes, true, true, undefined, false, true);
                    flower.scaling = new BABYLON.Vector3(0.02, 0.02, 0.02);
                    flower.position = new BABYLON.Vector3(0,6,0);                    
                    flower.checkCollisions = true;
                    flower.isPickable = true;
                    gizmoManager.attachableMeshes.push(flower);
                });
            });

            // changing camera mode button
            var cam_uni = new BABYLON.GUI.Button.CreateSimpleButton("camera_uni", "First person view");
            cam_uni.width = "150px";
            cam_uni.height = "35px";
            cam_uni.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            cam_uni.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            cam_uni.left = "270px";
            cam_uni.top = "10px";
            cam_uni.background = "#00ff7f";
            cam_uni.onPointerUpObservable.add(function(){
                setUniCam();
                cam_arc.isVisible = true;
                cam_uni.isVisible = false;
            });

            var cam_arc = new BABYLON.GUI.Button.CreateSimpleButton("camera_arc", "Third person view");
            cam_arc.width = "150px";
            cam_arc.height = "35px";
            cam_arc.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            cam_arc.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            cam_arc.left = "270px";
            cam_arc.top = "10px";
            cam_arc.background = "#00ff7f";
            cam_arc.onPointerUpObservable.add(function(){
                setArcCam();
                cam_arc.isVisible = false;
                cam_uni.isVisible = true;
            });

            // change scene buttons
            var room_a = new BABYLON.GUI.Button.CreateSimpleButton("swap_scene_a", "Scene A");
            room_a.width = "100px";
            room_a.height = "35px";
            room_a.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            room_a.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            room_a.left = "-125px";
            room_a.top = "10px";
            room_a.background = "#32cd32";
            room_a.onPointerUpObservable.add(function(){
                if (confirm('Are you sure you want to change to scene A? Any unsaved changes will be lost!')) {
                    ground_a.isVisible = true;
                    wall_a1.isVisible = true;
                    wall_a2.isVisible = true;
                    wall_a3.isVisible = true;
                    wall_a4.isVisible = true;

                    ground_a.checkCollisions = true;
                    wall_a1.checkCollisions = true;
                    wall_a2.checkCollisions = true;
                    wall_a3.checkCollisions = true;
                    wall_a4.checkCollisions = true;

                    ground_b.isVisible = false;
                    wall_b1.isVisible = false;
                    wall_b2.isVisible = false;
                    wall_b3.isVisible = false;
                    wall_b4.isVisible = false;
                    wall_b5.isVisible = false;
                    wall_b6.isVisible = false;

                    ground_b.checkCollisions = false;
                    wall_b1.checkCollisions = false;
                    wall_b2.checkCollisions = false;
                    wall_b3.checkCollisions = false;
                    wall_b4.checkCollisions = false;
                    wall_b5.checkCollisions = false;
                    wall_b6.checkCollisions = false;

                    for (var i = 0; i < gizmoManager.attachableMeshes.length; i++) {
                        gizmoManager.attachableMeshes[i].dispose();
                    }
                }
            });

            var room_b = new BABYLON.GUI.Button.CreateSimpleButton("swap_scene_b", "Scene B");
            room_b.width = "100px";
            room_b.height = "35px";
            room_b.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            room_b.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            room_b.left = "-10px";
            room_b.top = "10px";
            room_b.background = "#32cd32";
            room_b.onPointerUpObservable.add(function(){
                if (confirm('Are you sure you want to change to scene B? Any unsaved changes will be lost!')) {
                    ground_a.isVisible = false;
                    wall_a1.isVisible = false;
                    wall_a2.isVisible = false;
                    wall_a3.isVisible = false;
                    wall_a4.isVisible = false;

                    ground_a.checkCollisions = false;
                    wall_a1.checkCollisions = false;
                    wall_a2.checkCollisions = false;
                    wall_a3.checkCollisions = false;
                    wall_a4.checkCollisions = false;

                    ground_b.isVisible = true;
                    wall_b1.isVisible = true;
                    wall_b2.isVisible = true;
                    wall_b3.isVisible = true;
                    wall_b4.isVisible = true;
                    wall_b5.isVisible = true;
                    wall_b6.isVisible = true;

                    ground_b.checkCollisions = true;
                    wall_b1.checkCollisions = true;
                    wall_b2.checkCollisions = true;
                    wall_b3.checkCollisions = true;
                    wall_b4.checkCollisions = true;
                    wall_b5.checkCollisions = true;
                    wall_b6.checkCollisions = true;
                    
                    for (var i = 0; i < gizmoManager.attachableMeshes.length; i++) {
                        gizmoManager.attachableMeshes[i].dispose();
                    }
                }
            });

            // save scene button
            var save_scene = new BABYLON.GUI.Button.CreateSimpleButton("save_scene", "Save Scene");
            save_scene.width = "110px";
            save_scene.height = "35px";
            save_scene.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            save_scene.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            save_scene.left = "10px";
            save_scene.top = "10px";
            save_scene.background = "#f0e68c";
            save_scene.onPointerUpObservable.add(function(){
                if (confirm('Do you want to download that scene?')) {
                        download_scene('scene.babylon', scene);
                }
            });

            // current status text box
            var text1 = new BABYLON.GUI.TextBlock();
            text1.text = "Current Status: Neutral";
            text1.color = "#aaaaaa";
            text1.textHorizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            text1.textVerticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            text1.left = "10px";
            text1.top = "60px";
            text1.fontSize = 24;

            // upload item button
            var upload_item = new BABYLON.GUI.Button.CreateSimpleButton("upload_item", "Upload Item");
            upload_item.width = "110px";
            upload_item.height = "35px";
            upload_item.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            upload_item.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            upload_item.left = "130px";
            upload_item.top = "10px";
            upload_item.background = "#f0e68c";
            upload_item.onPointerUpObservable.add(function(evt){
                
            // create input_form 
            var input_form = window.document.createElement('input');
            input_form.type = "file";
            input_form.id = "files";
                
            // create file handler function
            function handle_file(evt) {

                // get file from form
                var files = evt.target.files;

                // create a temporary URL for file
                var tmp_path = URL.createObjectURL(files[0]);
                console.log(tmp_path);
                // append file
                BABYLON.SceneLoader.ImportMesh(null, "",tmp_path, scene, function(meshes) {
                        
                    var mesh = meshes[0];
                    
                    console.log(meshes);
                    try{
                        // merge the mesh into one
                        mesh = BABYLON.Mesh.MergeMeshes(meshes, true, true, undefined, false, true);
                            
                    }
                    catch(error){
                        console.log(error);
                    }
                    mesh.checkCollisions = true;
                    mesh.position = new BABYLON.Vector3(0,6,0);
                    gizmoManager.attachableMeshes.push(mesh);
                });
                
                
            }
            // set listener onto file uploader
            input_form.addEventListener('change', handle_file, false);

            // create click event to click the input_form
            var click = document.createEvent("MouseEvents");
            click.initEvent("click", true, false);
            input_form.dispatchEvent(click);
                
            });

            // adding control on the ui
            ui.addControl(wall_but1);
            ui.addControl(wall_but2);
            ui.addControl(wall_but3);
            ui.addControl(wall_but4);
            ui.addControl(floor_but1);
            ui.addControl(floor_but2);
            ui.addControl(floor_but3);
            ui.addControl(floor_but4);
            ui.addControl(sofa_add);
            ui.addControl(table_add);
            ui.addControl(chair_add);
            ui.addControl(bed_add);
            ui.addControl(toilet_add);
            ui.addControl(flower_add);
            ui.addControl(cam_uni);
            ui.addControl(cam_arc);
            ui.addControl(room_a);
            ui.addControl(room_b);
            ui.addControl(save_scene);
            ui.addControl(upload_item);
            text_ui.addControl(text1);

            cam_arc.isVisible = false;

            return scene;
        };

        var downloadUrl;
        function download_scene(filename, scene) {
            // delete download url if it exists
            if(downloadUrl) {
                window.URL.revokedownloadUrl(downloadUrl);
            }

            // serializer scene
            var serializedScene = BABYLON.SceneSerializer.Serialize(scene);

            // convert serialized scene into string
            var strScene = JSON.stringify(serializedScene);

            // create a blob from the string
            var blob = new Blob ( [ strScene ], { type : "octet/stream" } );

            // turn blob into an object URL
            downloadUrl = window.URL.createObjectURL(blob);

            // create download element
            var link = window.document.createElement('a');
            link.href = downloadUrl;
            link.download = filename;

            // create click event to click the link
            var click = document.createEvent("MouseEvents");
            click.initEvent("click", true, false);
            link.dispatchEvent(click);          
        }

        var scene = createScene(); // scene displaying goes here...

        engine.runRenderLoop(function(){ // renders the scene via loop
            scene.render();
        });

        window.addEventListener("resize", function(){
            engine.resize();
        });
    </script>
</body>
</html>